<%= form_with model: @card, url: couples_cards_path, method: :post, local: true do |f| %>
  <div class="flex flex-row space-x-5 h-200">
    
    <!-- Template Selection -->
    <div class="flex flex-col space-y-6">
      <h3 class="text-xl font-semibold">Choose Template</h3>

      <div class="flex flex-col overflow-y-auto space-y-2 no-scrollbar p-4">
        <% (1..4).each do |i| %>
          <div 
            class="bg-white shadow border p-1 w-60 hover:border-2 hover:border-red-400 cursor-pointer template-image"
            data-template-id="<%= i %>">
            <%= image_tag "card_templates/#{i}.png", class: "h-auto", alt: "template #{i}" %>
          </div>
        <% end %>
      </div>

      </div>

    <!-- Card Details -->
    <div class="flex flex-col w-full justify-center items-center">
      <div class="shadow w-150 p-4 rounded shadow-sm p-6">
        <h1 class="text-2xl font-bold mb-4 text-center">Customize Your Wedding Card</h1>

        <div class="mb-4">
          <%= f.label :invitation_line, class: "block font-medium mb-1" %>
          <%= f.text_field :invitation_line, class: "border border-red-300 p-2 w-full rounded-sm" %>
        </div>

        <div class="mb-4">
          <%= f.label :venue, class: "block font-medium mb-1" %>
          <%= f.text_field :venue, class: "border border-red-300 p-2 w-full rounded-sm" %>
        </div>

        <div class="mb-4">
          <%= f.label :event_id, "Select Event", class: "block font-medium mb-1" %>
          <%= f.select :event_id, options_from_collection_for_select(@events, :id, :event_name_with_date), { prompt: "Select your event" }, class: "border border-red-300 p-2 w-full rounded-sm hover:border-red-300 focus:outline-none focus:border-red-400 focus:border-2" %>
        </div>

        <div class="mb-4">
          <%= f.label :event_time, class: "block font-medium mb-1" %>
          <%= f.time_field :event_time, class: "border border-red-300 p-2 w-full rounded-sm" %>
        </div>

        <div class="mb-4">
          <%= f.label :rsvp_contact, class: "block font-medium mb-1" %>
          <%= f.text_field :rsvp_contact, class: "border border-red-300 p-2 w-full rounded-sm" %>
        </div>

        <div class="mb-4">
            <%= f.label :template, "Selected Template", class: "block font-medium mb-1" %>
            <%= f.text_field :template,  id: "selected-template-#{@card.id || 'new'}", class: "border border-red-300 p-2 w-full rounded-sm", readonly: true %>
        </div>
        

        <%= f.submit "Generate Card", class: "bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded" %>
      </div>
    </div>
  </div>
<% end %>
<script>
  document.addEventListener("turbo:load", function () {
    const allForms = document.querySelectorAll("form");

    allForms.forEach(form => {
      const templates = form.querySelectorAll(".template-image");
      const input = form.querySelector("[id^='selected-template']");

      if (!input) return;

      templates.forEach(template => {
        template.addEventListener("click", () => {
          const id = template.getAttribute("data-template-id");
          input.value = `${id}`;

          templates.forEach(t => t.classList.remove("border-red-400", "border-2"));
          template.classList.add("border-red-400", "border-2");
        });
      });
    });
  });
</script>


