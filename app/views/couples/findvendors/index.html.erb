<div class = "mx-20">
<div class = "font-bold text-3xl mt-4">
    <h1>Find Vendors</h1>
</div>
<form class="w-full my-4 ">   
    <div class="relative">
        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
            </svg>
        </div>
        <%= search_form_for @q, url: couples_findvendors_path, method: :get do |f| %>
          
          
          <%= f.text_field :username_cont,
          {
            class: "block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400",
            placeholder: "Search for vendors",
            required: true
          } %>
          <%= f.submit "Search", class: "text-white absolute end-2.5 bottom-2.5 bg-red-400 hover:bg-red-500 focus:ring-4 focus:outline-none font-medium rounded-lg text-sm px-4 py-2"%>
        <% end %>
      </div>
</form>

<div class="flex flex-wrap gap-2">
  <%= link_to couples_findvendors_path, 
      class: "rounded-full px-4 py-1 text-center text-sm bg-red-200 hover:bg-red-300" do %>
    All
  <% end %>

  <% Vendor::SERVICE_TYPES.each do |category| %>
    
    <%= link_to couples_findvendors_path(q: { category_eq: category }), class: "bg-red-200 hover:bg-red-300 rounded-full px-4 py-1 text-center text-sm transition" do %>
      <%= category %>
    <% end %>
  <% end %>
</div>


<div class="flex flex-col gap-4 mt-6">
  <% @vendors.each do |vendor| %>
    <%= link_to couples_findvendor_path(vendor), class: "block " do %>
    <div class="bg-gray-100 rounded-xl border border-red-200 w-full px-4 py-3 hover:border hover:border-red-400">
      <div class="flex items-center justify-between">
        
        <div class="flex items-center gap-4">

          <% if vendor.user&.profile_image&.attached? %>
            <%= image_tag url_for(vendor.user.profile_image), class: "w-16 h-16 rounded-full object-cover shadow-md" %>
          <% else %>
            <img src="https://www.svgrepo.com/download/512697/profile-1341.svg"
              alt="Default Profile"
              class="w-16 h-16 rounded-full object-cover shadow-md bg-gray-200" />
          <% end %>


          <div class="flex flex-col">
            <p class="font-semibold text-base text-black"><%= vendor.username %></p>
            <p class="text-sm text-grey-200"><%= vendor.category %></p>
            <p class="text-md text-red-400"> <%= vendor.location %></p>
          </div>
        </div>

        <% avg_rating = vendor.services.flat_map(&:ratings).pluck(:stars).compact.presence&.yield_self { |stars| (stars.sum.to_f / stars.size).round(1) } || "0.0" %>
        <div class="text-right text-lg font-medium text-gray-700">
          <%= avg_rating %>
        </div>



      </div>
    </div>
  <% end %>
  <% end %>
</div>
</div>
