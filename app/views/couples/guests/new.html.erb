
<div class = "flex flex-col justify-start h-full w-full">
  <div class = "flex flex-row justify-between mx-20 mt-10">
    <div class = "font-bold text-lg">Guest List</div>

        <div data-controller="dialog"  class="relative">
            <!-- Open Modal Button -->
            <button 
                data-action="click->dialog#open" 
                class="bg-red-300 text-white px-4 py-2 rounded hover:bg-red-400">
                Add Guest
            </button>

            <div data-dialog-target="backdrop"class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40 hidden transition-opacity">
        </div>
        <dialog data-dialog-target="modal"class="fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 open:flex rounded-md p-0 overflow-hidden shadow-lg w-full max-w-md hidden">
            <%= form_with url: couples_guest_path, method: :post, local: true, class:"bg-gray-100 h-full w-full flex flex-col space-y-6 p-6" do |f| %>
            <h2 class="text-xl font-semibold text-center text-red-400">Add Guest</h2>

            <div class = "mb-4">
                    <%= label_tag :name, "Guest Name", class: "block text-sm font-medium mb-1" %>
                    <%= text_field_tag "guest[name]", nil, class:"w-full border border-red-300 rounded px-3 py-2", required: true %>
            </div >

            <div class ="mb-4">
                <%= label_tag :whatsapp, "Whatsapp Name", class: "block text-sm font-medium mb-1" %>
                <%= text_field_tag "guest[whatsapp]", nil, class:"w-full border border-red-300 rounded px-3 py-2", placeholder: "+92XXXXXXXXXX", required: true %>
            </div>


            <div class="mb-4">
            <label for="event_id" class="block font-medium mb-1">Select Event</label>
            <select name="guest[event_id]" id="event_id"
                    class="border border-red-300 p-2 w-full rounded-sm hover:border-red-300 focus:outline-none focus:border-red-400 focus:border-2"
                    required>
                <option value="" disabled selected>Select your event</option>
                <% @events.each do |event| %>
                <option value="<%= event.id %>">
                    <%= "#{event.event_name} - #{event.event_date.strftime('%b %d, %Y')}" %>
                </option>
                <% end %>
            </select>
            </div>


            <div class="flex justify-between mt-4">
                <%= submit_tag "Add", class:"bg-red-300 text-white px-4 py-2 rounded hover:bg-red-400"%>
                <button type="button" data-action = "click->dialog#close"  class="border border-red-400 text-red-500 px-4 py-2 rounded hover:bg-red-100">Cancel</button>
            </div>

            <% end %>

        </dialog>
    </div>


    </div>


    <div class="space-y-8 w-full">
    <% current_user.authenticatable.events.each do |event| %>
        <div onclick="myFunction(<%= event.id %>)" class="flex flex-col bg-gray-100 p-4 m-4 rounded-2xl shadow mx-20 space-y-2">
            <div class ="flex flex-row justify-between m-4">
                <div class="flex flex-col">
                    <strong class="text-lg font-semibold"><%= event.event_name %></strong>
                    <span class="text-sm text-gray-700"><%= event.event_date.strftime('%b %d, %Y') %></span>
                </div>
                <button class = "h-10 w-10">
                    <img src="https://www.svgrepo.com/download/493938/more-unfold.svg" alt="Unfold Icon">
                </button>

            </div>
        

        <table id="guests-for-<%= event.id %>" style="display: none;" class="table-auto w-full border border-red-300 mt-4">

        <thead>
            <tr class="bg-red-100 text-left">
            <th class="px-4 py-2 border border-red-500">Guest Name</th>
            <th class="px-4 py-2 border border-red-500">Whatsapp Number</th>
            <th class="px-4 py-2 border border-red-500">Invitation Sent</th>
            </tr>
        </thead>

        <tbody>
            <% if event.guests.any? %>
            <% event.guests.each do |guest| %>
                <tr class="bg-white even:bg-red-50">
                <td class="px-4 py-2 border border-red-500"><%= guest.name %></td>
                <td class="px-4 py-2 border border-red-500"><%= guest.whatsapp %></td>
                <td class="px-4 py-2 border border-red-500">Nhi bulana</td> 
                </tr>
            <% end %>
            <% else %>
            <tr>
                <td colspan="3" class="text-gray-500 italic px-4 py-2 text-center border border-red-500">
                No guests added for this event yet.
                </td>
            </tr>
            <% end %>
        </tbody>
        </table>


        </div>
    <% end %>
    </div>
    
</div>
<script>
  function myFunction(eventId) {
    var table = document.getElementById("guests-for-" + eventId);
    if (table.style.display === "none") {
      table.style.display = "table"; 
    } else {
      table.style.display = "none";
    }
  }
</script>



