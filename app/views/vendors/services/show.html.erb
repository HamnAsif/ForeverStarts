<div>
  <div class="flex flex-row justify-between mt-7">
    <div>
      <h1 class="text-2xl font-bold mb-2"><%= @service.title %></h1>
      <h3 class="text-lg font-semibold mb-2">Price: <%= @service.price %></h3>
      <p class="text-gray-700 mb-6"><%= @service.caption %></p>
    </div>
    <div class = "flex flex-col space-y-4">
        <div data-controller="dialog"  class="relative">
                <!-- Open Modal Button -->
                <button 
                    data-action="click->dialog#open" 
                    class="bg-red-400 text-white px-4 py-2 rounded hover:bg-red-500">
                    Edit Service
                </button>

                <div data-dialog-target="backdrop"class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40 hidden transition-opacity"></div>
                <dialog data-dialog-target="modal"class="fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 open:flex rounded-md p-0 overflow-hidden shadow-lg w-full max-w-md hidden">
                <%= form_with model: @service, url: vendors_service_path(@service), method: :patch, multipart: true, local: true, class:"bg-gray-100 h-full w-full flex flex-col space-y-6 p-6" do |f| %>
                <h2 class="text-xl font-semibold text-center text-red-400">Edit Service</h2>

                <div class="mb-4">
                  <%= f.label :title, class: "block font-medium mb-1" %>
                  <%= f.text_field :title, class: "border border-red-300 p-2 w-full rounded-sm" %>
                </div>
                <div class="mb-4">
                  <%= f.label :price, class: "block font-medium mb-1" %>
                  <%= f.number_field :price, class: "border border-red-300 p-2 w-full rounded-sm" %>
                </div>

                <div>
                    <%= f.label :caption, class: "block font-medium mb-1" %>
                    <%= f.text_area :caption, rows: 4, class: "w-full border border-red-400 rounded px-4 py-2 focus:outline-none focus:border-red-400 focus:border-2" %>
                </div>

                <div class="mb-4">
                  <%= f.label :images, "Upload Images", class: "block font-medium mb-1" %>
                  <%= f.file_field :images, multiple: true, class: "block w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded file:border-0
                    file:text-sm file:font-semibold
                    file:bg-red-50 file:text-red-400
                    hover:file:bg-red-100" %>
                </div>
                <div class="flex justify-between mt-4">
                    <%= submit_tag "Done", class:"bg-red-400 text-white px-4 py-2 rounded hover:bg-red-500"%>
                    <button type="button" data-action = "click->dialog#close"  class="border border-red-400 text-red-500 px-4 py-2 rounded hover:bg-red-100">Cancel</button>
                </div>

                <% end %>

            </dialog>
          </div>
          <%= form_with url: vendors_service_path(@service), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this service?" } do %>
            <button  
              class="bg-red-400 text-white px-4 py-2 rounded hover:bg-red-500">
              Delete Service
            </button>
          <% end %>

        </div>
        
  </div>

<hr class="h-px my-4 bg-red-300 border-0">

  <% if @service.images.attached? %>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        <% @service.images.each do |image| %>
          
          <div class="relative w-full aspect-square overflow-hidden rounded-lg shadow group">
            <%= image_tag url_for(image),class: "w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" %>
            <div class="absolute inset-0 flex justify-end p-2">
              <%= button_to image_vendors_service_path(@service, image_id: image.id),
                  method: :delete,
                  form: { data: { turbo_confirm: "Are you sure you want to delete this image?" } },
                  class: "absolute top-2 right-2 bg-white/70 text-red-500 hover:text-red-700 hover:bg-white rounded-full w-9 h-9 flex items-center justify-center text-3xl shadow font-semi-bold pb-2" do %>
                &times;
              <% end %>
            </div>


          </div>
        <% end %>
      </div>
    <% else %>
      <div class="bg-gray-100 w-full h-64 flex items-center justify-center text-gray-400 mb-4">
        No Images Available
      </div>
    <% end %>


<hr class="h-px my-6 bg-red-300 border-0">

<h2 class="text-xl font-semibold text-red-400 mb-4">Customer Reviews</h2>


<% if @ratings.any? %>
  <div class="space-y-4">
    <% @ratings.each do |rating| %>
      <div class="bg-gray-100 p-4 rounded-lg shadow-sm border">
        <div class="flex items-center space-x-1">
          <% 5.times do |i| %>
            <span class="text-xl <%= i < rating.stars ? 'text-yellow-400' : 'text-gray-300' %>">
              ★
            </span>
        <% end %>
      </div>
        <p class="text-gray-800 mt-2">
          "<%= rating.feedback %>"
        </p>
        

        <% if rating.couple && rating.couple.user %>
          <p class="text-sm text-gray-500 mt-1">
            — <%= "#{rating.couple.bride_name} & #{rating.couple.groom_name}" rescue rating.couple.user.email %>
          </p>
        <% end %>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="text-gray-500">No reviews yet for this service.</p>
<% end %>

</div>
